<!DOCTYPE html>
<html>

<head>
    <title>Interactive 2 x 1 Rubik's Cube</title>

    <script src="https://www.ecst.csuchico.edu/~oal-saadi/Graphics/source/glsim.js"></script>

    <script> //Add OpenGL Code Here

        var rotateX = 15;   // rotations of cube about the axes
        var rotateY = -15;
        var rotateZ = 0;

        // ------------------- functions for drawing the cube -------------------

        function cube(size) {

            glScalef(size, size, size); // scale unit cube to desired size

            glBegin(GL_QUADS);
            // Front face (z+)
            glColor3f(1, 0, 0); // Red
            glVertex3f(-1, -1, 1);
            glVertex3f(1, -1, 1);
            glVertex3f(1, 1, 1);
            glVertex3f(-1, 1, 1);

            // Back face (z-)
            glColor3f(1, 0.5, 0); // Orange
            glVertex3f(-1, -1, -1);
            glVertex3f(-1, 1, -1);
            glVertex3f(1, 1, -1);
            glVertex3f(1, -1, -1);

            // Top face (y+)
            glColor3f(1, 1, 1); // White
            glVertex3f(-1, 1, -1);
            glVertex3f(-1, 1, 1);
            glVertex3f(1, 1, 1);
            glVertex3f(1, 1, -1);

            // Bottom face (y-)
            glColor3f(1, 1, 0); // Yellow
            glVertex3f(-1, -1, -1);
            glVertex3f(1, -1, -1);
            glVertex3f(1, -1, 1);
            glVertex3f(-1, -1, 1);

            // Right face (x+)
            glColor3f(0, 0, 1); // Blue
            glVertex3f(1, -1, -1);
            glVertex3f(1, 1, -1);
            glVertex3f(1, 1, 1);
            glVertex3f(1, -1, 1);

            // Left face (x-)
            glColor3f(0, 1, 0); // Green
            glVertex3f(-1, -1, -1);
            glVertex3f(-1, -1, 1);
            glVertex3f(-1, 1, 1);
            glVertex3f(-1, 1, -1);
            glEnd();
        }


        // ----------------------------------------------------------------------

        function display() {  // Draws the image.

            glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

            glLoadIdentity(); // Set up modelview transform. 
            glRotatef(rotateZ, 0, 0, 1);
            glRotatef(rotateY, 0, 1, 0);
            glRotatef(rotateX, 1, 0, 0);
            for (let c of cubies) {
                glPushMatrix();
                glTranslatef(c.pos[0], c.pos[1], c.pos[2]);
                glRotatef(c.rot[0], 1, 0, 0);
                glRotatef(c.rot[1], 0, 1, 0);
                glRotatef(c.rot[2], 0, 0, 1);
                cube(0.3);
                glPopMatrix();
            }
        }

        function initGL() {
            glMatrixMode(GL_PROJECTION);
            glOrtho(-1, 1, -1, 1, -1, 1); // Orthographic Projection
            glMatrixMode(GL_MODELVIEW);
            glEnable(GL_DEPTH_TEST);
            glClearColor(0, 0, 0, 1);
        }

        const cubies = [
            { pos: [-0.305, 0, 0], rot: [0, 0, 0] },
            { pos: [0.305, 0, 0], rot: [0, 0, 0] }
        ]

        const keys = { // Constant values for key codes
            LEFT: 37,
            UP: 38,
            RIGHT: 39,
            DOWN: 40,
            W: 87,
            A: 65,
            S: 83,
            D: 68,
            SPACE: 32,
            I: 73,
            J: 74,
            K: 75,
            L: 76,
            R: 82,
            F: 70
        };

        function doKeyDown(e) {
            var key = e.keyCode;
            if (key == keys.LEFT || key == keys.J)
                rotate('y', false);
            else if (key == keys.RIGHT || key == keys.L)
                rotate('y', true);
            else if (key == keys.DOWN || key == keys.K)
                rotate('x', true);
            else if (key == keys.UP || key == keys.I)
                rotate('x', false);
            else if (key == keys.D)
                rotate('z', false);
            else if (key == keys.A)
                rotate('z', true);
            else if (key == keys.SPACE) {
                rotateX = 15;
                rotateY = -15;
                rotateZ = 0;
            }
            else if (key == keys.W) {
                rotate('w', false);
            }
            else if (key == keys.S) {
                rotate('w', true);
            }
            else if (key == keys.R) {
                rotate('v', false);
            }
            else if (key == keys.F) {
                rotate('v', true);
            }
            display();
        }

        function rotate(plane, positive) {
            rotateRecursive(plane, positive, 18);
        }
        function rotateRecursive(plane, positive, steps) {
            if (steps <= 0) return;
            if (plane == 'x') {
                rotateX += (positive ? 5 : -5);
            } else if (plane == 'y') {
                rotateY += (positive ? 5 : -5);
            } else if (plane == 'z') {
                rotateZ += (positive ? 5 : -5);
            } else if (plane == 'w') {
                cubies[0].rot[0] += (positive ? 5 : -5);
            } else if (plane == 'v') {
                cubies[1].rot[0] += (positive ? 5 : -5);
            }
            setTimeout(() => rotateRecursive(plane, positive, steps - 1), 5);
            display();
        }

        function init() {  // Called by , when the page has loaded.
            glsimUse("glcanvas"); // OpenGL will draw to the canvas with id="glcanvas".
            document.onkeydown = doKeyDown;
            initGL();
            display();
        }
    </script>

</head>

<br>

<body onload="init();" style="background-color:black;">
    <div style="text-align: center;">
        <font size="12" style = "color: yellow;"> Interactive 2 x 1 Rubik's Cube </font>
        <br>
        <canvas id="glcanvas" width="600" height="600"
            style="border: 4px solid white; background-color:rgb(240, 240, 240);">
        </canvas>
        <br>
        <font style = "color: yellow;">
        Arrow Keys (or I/J/K/L): Rotate Cube <br>
        A/D: Rotate about Z axis <br>
        W/S/R/F: Twist Cubies <br>
        Spacebar: Reset Rotation <br>
        </font>
    </div>

</body>

</html>